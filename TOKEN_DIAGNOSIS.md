# æ–°è´¦å·ç™»å½•åæ¥å£è°ƒç”¨å¤±è´¥è¯Šæ–­æŠ¥å‘Š

## é—®é¢˜æè¿°
æ–°è´¦å·ç™»å½•åæ‰€æœ‰æ¥å£éƒ½ç”¨ä¸äº†

## å·²è¯†åˆ«çš„é—®é¢˜

### 1. Tokenè·å–é€»è¾‘é—®é¢˜ âœ… å·²ä¿®å¤
- **é—®é¢˜**: `getInitialToken()` å‡½æ•°è¢«ç¦ç”¨ï¼Œæ€»æ˜¯è¿”å› `null`
- **å½±å“**: å½“tokenæœªæ­£ç¡®ä¿å­˜æ—¶ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ç¼ºå°‘è®¤è¯å¤´
- **ä¿®å¤**: é‡æ–°å¯ç”¨tokenè·å–é€»è¾‘ï¼Œä»localStorageè¯»å–token

### 2. Tokenåˆ·æ–°æœºåˆ¶ç¼ºå¤± âœ… å·²ä¿®å¤
- **é—®é¢˜**: 401é”™è¯¯æ—¶ç›´æ¥è·³è½¬ç™»å½•é¡µï¼Œä¸å°è¯•åˆ·æ–°token
- **å½±å“**: tokenè¿‡æœŸåæ— æ³•è‡ªåŠ¨æ¢å¤ï¼Œéœ€è¦é‡æ–°ç™»å½•
- **ä¿®å¤**: å¢åŠ tokenåˆ·æ–°é€»è¾‘ï¼Œå¤±è´¥åå†è·³è½¬ç™»å½•é¡µ

## ä¿®å¤å†…å®¹

### Request.js ä¿®å¤
1. **å¯ç”¨ getInitialToken å‡½æ•°**
   ```javascript
   const getInitialToken = async () => {
     const token = localStorage.getItem('token')
     if (token) {
       console.log('ğŸ”‘ ä»localStorageè·å–åˆ°token')
       return token
     }
     return null
   }
   ```

2. **å¢å¼º 401 é”™è¯¯å¤„ç†**
   ```javascript
   if (error.response?.status === 401) {
     const newToken = await refreshToken()
     if (newToken) {
       // é‡è¯•åŸè¯·æ±‚
       const originalRequest = error.config
       originalRequest.headers.Authorization = `Bearer ${newToken}`
       return request(originalRequest)
     } else {
       // æ¸…é™¤è®¤è¯ä¿¡æ¯ï¼Œè·³è½¬ç™»å½•é¡µ
     }
   }
   ```

### è°ƒè¯•å·¥å…·
åˆ›å»ºäº† `tokenDebugger.js` ç”¨äºè¯Šæ–­tokençŠ¶æ€ï¼š
- `tokenDebugger.checkTokenStatus()` - æ£€æŸ¥tokençŠ¶æ€
- `tokenDebugger.clearAuth()` - æ¸…é™¤è®¤è¯ä¿¡æ¯
- `tokenDebugger.setTestToken()` - è®¾ç½®æµ‹è¯•token

## æµ‹è¯•æ­¥éª¤

### 1. å¼€å¯å¼€å‘è€…å·¥å…·
åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š
```javascript
tokenDebugger.checkTokenStatus()
```

### 2. ç™»å½•æµ‹è¯•
1. ä½¿ç”¨æ–°è´¦å·ç™»å½•
2. æ£€æŸ¥tokenæ˜¯å¦æ­£ç¡®ä¿å­˜
3. æµ‹è¯•è°ƒç”¨éœ€è¦è®¤è¯çš„API

### 3. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
åœ¨Networkæ ‡ç­¾é¡µä¸­æ£€æŸ¥ï¼š
- è¯·æ±‚å¤´æ˜¯å¦åŒ…å« `Authorization: Bearer xxx`
- 401é”™è¯¯æ˜¯å¦æ­£ç¡®å¤„ç†å’Œé‡è¯•

## å¯èƒ½çš„å‰©ä½™é—®é¢˜

### 1. ç™»å½•å“åº”æ ¼å¼ä¸åŒ¹é…
- æ£€æŸ¥æœåŠ¡å™¨è¿”å›çš„tokenå­—æ®µå
- ç¡®è®¤ `data.token` æˆ–ç›´æ¥ `token` å­—æ®µå­˜åœ¨

### 2. æ–°è´¦å·æƒé™é—®é¢˜
- æ–°è´¦å·å¯èƒ½éœ€è¦åˆå§‹åŒ–æƒé™
- æ£€æŸ¥æœåŠ¡å™¨ç«¯çš„æ–°ç”¨æˆ·å¤„ç†é€»è¾‘

### 3. æœåŠ¡å™¨ç«¯tokenéªŒè¯
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£ç¡®éªŒè¯Bearer token
- ç¡®è®¤tokenæ ¼å¼å’ŒåŠ å¯†ç®—æ³•åŒ¹é…

## ä¸‹ä¸€æ­¥è°ƒè¯•å»ºè®®

1. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**: å…³æ³¨tokenç›¸å…³çš„æ—¥å¿—è¾“å‡º
2. **æ£€æŸ¥ç½‘ç»œè¯·æ±‚**: ç¡®è®¤è¯è¯·æ±‚å¤´æ­£ç¡®
3. **éªŒè¯æœåŠ¡å™¨å“åº”**: ç¡®è®¤APIè¿”å›çš„é”™è¯¯ä¿¡æ¯
4. **æµ‹è¯•tokenåˆ·æ–°**: éªŒè¯refresh tokenæœºåˆ¶æ˜¯å¦å·¥ä½œ

## ä½¿ç”¨æ–¹æ³•

å¼€å‘ç¯å¢ƒå¯åŠ¨åï¼š
1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:3000`
2. ç™»å½•æ–°è´¦å·
3. åœ¨æ§åˆ¶å°è¿è¡Œ `tokenDebugger.checkTokenStatus()` æ£€æŸ¥çŠ¶æ€
4. å°è¯•è°ƒç”¨APIï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º

---
*æ­¤æ–‡æ¡£è®°å½•äº†æ–°è´¦å·ç™»å½•åæ¥å£è°ƒç”¨å¤±è´¥é—®é¢˜çš„è¯Šæ–­å’Œä¿®å¤è¿‡ç¨‹*